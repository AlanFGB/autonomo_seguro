<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autônomo Seguro - Dossiê Jurídico</title>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @media print {
            .print\:hidden { display: none !important; }
            body { background: white; }
            .print\:shadow-none { shadow: none !important; border: none !important; }
        }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Componentes de UI ---
        const Shield = () => <i data-lucide="shield" className="w-6 h-6"></i>;
        const Briefcase = () => <i data-lucide="briefcase" className="w-5 h-5"></i>;
        const FileText = () => <i data-lucide="file-text" className="w-5 h-5"></i>;
        const User = () => <i data-lucide="user" className="w-5 h-5"></i>;
        const Download = () => <i data-lucide="download" className="w-5 h-5"></i>;
        const DollarSign = () => <i data-lucide="dollar-sign" className="w-5 h-5"></i>;
        const MapPin = () => <i data-lucide="map-pin" className="w-4 h-4"></i>;
        const Trash2 = () => <i data-lucide="trash-2" className="w-5 h-5"></i>;
        const CheckCircle = () => <i data-lucide="check-circle" className="w-5 h-5"></i>;
        const Lock = () => <i data-lucide="lock" className="w-4 h-4"></i>;

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [clients, setClients] = useState(() => JSON.parse(localStorage.getItem('as_clients') || '[]'));
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('as_logs') || '[]'));

            useEffect(() => {
                localStorage.setItem('as_clients', JSON.stringify(clients));
                localStorage.setItem('as_logs', JSON.stringify(logs));
                lucide.createIcons();
            }, [clients, logs, activeTab]);

            // Funções de Negócio
            const addClient = (e) => {
                e.preventDefault();
                const form = e.target;
                const newC = { 
                    id: Date.now().toString(), 
                    name: form.name.value, 
                    cnpj: form.cnpj.value 
                };
                setClients([...clients, newC]);
                form.reset();
            };

            const addLog = (e) => {
                e.preventDefault();
                const form = e.target;
                const newL = {
                    id: Date.now().toString(),
                    clientId: form.clientId.value,
                    date: form.date.value,
                    type: form.type.value,
                    description: form.description.value,
                    amount: parseFloat(form.amount.value || 0),
                    integrityHash: "AS-" + Math.random().toString(36).substr(2, 9).toUpperCase()
                };
                setLogs([newL, ...logs]);
                form.reset();
            };

            const deleteLog = (id) => {
                if(confirm("Excluir esta prova permanentemente?")) {
                    setLogs(logs.filter(l => l.id !== id));
                }
            };

            return (
                <div className="flex flex-col md:flex-row min-h-screen">
                    {/* Sidebar */}
                    <aside className="w-full md:w-64 bg-indigo-950 text-white p-6 print:hidden">
                        <div className="flex items-center gap-3 mb-10">
                            <div className="bg-indigo-600 p-2 rounded-lg"><Shield /></div>
                            <span className="font-bold text-xl">Autônomo Seguro</span>
                        </div>
                        <nav className="space-y-2">
                            <button onClick={() => setActiveTab('dashboard')} className={`w-full flex items-center gap-3 p-3 rounded-lg ${activeTab === 'dashboard' ? 'bg-indigo-600' : 'hover:bg-indigo-900'}`}>
                                <Briefcase /> Dashboard
                            </button>
                            <button onClick={() => setActiveTab('logs')} className={`w-full flex items-center gap-3 p-3 rounded-lg ${activeTab === 'logs' ? 'bg-indigo-600' : 'hover:bg-indigo-900'}`}>
                                <FileText /> Diário de Provas
                            </button>
                            <button onClick={() => setActiveTab('clients')} className={`w-full flex items-center gap-3 p-3 rounded-lg ${activeTab === 'clients' ? 'bg-indigo-600' : 'hover:bg-indigo-900'}`}>
                                <User /> Clientes
                            </button>
                            <button onClick={() => setActiveTab('report')} className={`w-full flex items-center gap-3 p-3 rounded-lg ${activeTab === 'report' ? 'bg-indigo-600' : 'hover:bg-indigo-900'}`}>
                                <Download /> Gerar Dossiê
                            </button>
                        </nav>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 p-6 md:p-12">
                        {activeTab === 'dashboard' && (
                            <div>
                                <h1 className="text-3xl font-bold mb-8">Painel de Proteção</h1>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-500">
                                        <p className="text-slate-500 text-sm font-bold uppercase">Provas Registradas</p>
                                        <h2 className="text-4xl font-black mt-2">{logs.length}</h2>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-emerald-500">
                                        <p className="text-slate-500 text-sm font-bold uppercase">Total Faturado</p>
                                        <h2 className="text-4xl font-black mt-2">R$ {logs.reduce((a,b) => a + b.amount, 0).toFixed(2)}</h2>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-amber-500">
                                        <p className="text-slate-500 text-sm font-bold uppercase">Tomadores Ativos</p>
                                        <h2 className="text-4xl font-black mt-2">{clients.length}</h2>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'logs' && (
                            <div className="max-w-4xl">
                                <h2 className="text-2xl font-bold mb-6">Registrar Nova Evidência</h2>
                                <form onSubmit={addLog} className="bg-white p-6 rounded-xl shadow-md space-y-4 mb-10">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <select name="clientId" className="p-3 border rounded-lg bg-slate-50" required>
                                            <option value="">Selecione o Cliente</option>
                                            {clients.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                        </select>
                                        <input type="date" name="date" className="p-3 border rounded-lg bg-slate-50" required />
                                        <select name="type" className="p-3 border rounded-lg bg-slate-50">
                                            <option>Execução de Serviço</option>
                                            <option>Decisão Técnica Independente</option>
                                            <option>Recusa de Horário Fixo</option>
                                        </select>
                                        <input type="number" name="amount" placeholder="Valor (R$)" step="0.01" className="p-3 border rounded-lg bg-slate-50" />
                                    </div>
                                    <textarea name="description" placeholder="Descreva os fatos que comprovam sua autonomia..." className="w-full p-3 border rounded-lg bg-slate-50" rows="3" required></textarea>
                                    <button type="submit" className="w-full bg-indigo-600 text-white p-4 rounded-lg font-bold flex justify-center gap-2">
                                        <CheckCircle /> Autenticar Registro Local
                                    </button>
                                </form>

                                <div className="space-y-4">
                                    {logs.map(log => (
                                        <div key={log.id} className="bg-white p-4 rounded-lg shadow-sm border-l-8 border-indigo-500 flex justify-between items-center">
                                            <div>
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="text-[10px] font-mono bg-indigo-50 text-indigo-600 px-1 rounded">HASH: {log.integrityHash}</span>
                                                    <span className="text-xs text-slate-400">{log.date}</span>
                                                </div>
                                                <h4 className="font-bold">{clients.find(c => c.id === log.clientId)?.name}</h4>
                                                <p className="text-sm text-slate-600">{log.description}</p>
                                            </div>
                                            <button onClick={() => deleteLog(log.id)} className="text-slate-300 hover:text-red-500 p-2"><Trash2 /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'clients' && (
                            <div className="max-w-2xl">
                                <h2 className="text-2xl font-bold mb-6">Gestão de Tomadores</h2>
                                <form onSubmit={addClient} className="bg-white p-6 rounded-xl shadow-md flex gap-2 mb-8">
                                    <input name="name" placeholder="Nome do Cliente" className="flex-1 p-3 border rounded-lg" required />
                                    <input name="cnpj" placeholder="CNPJ/CPF" className="p-3 border rounded-lg" required />
                                    <button className="bg-indigo-600 text-white px-6 rounded-lg font-bold">Salvar</button>
                                </form>
                                <div className="grid grid-cols-1 gap-4">
                                    {clients.map(c => (
                                        <div key={c.id} className="bg-white p-4 rounded-lg flex items-center gap-4 border">
                                            <div className="bg-indigo-100 p-3 rounded-full text-indigo-600 font-bold">{c.name[0]}</div>
                                            <div>
                                                <p className="font-bold">{c.name}</p>
                                                <p className="text-xs text-slate-500">{c.cnpj}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'report' && (
                            <div className="space-y-8">
                                <div className="bg-indigo-900 p-8 rounded-2xl text-white flex justify-between items-center print:hidden">
                                    <div>
                                        <h2 className="text-2xl font-bold">Dossiê Material Pronto</h2>
                                        <p className="text-indigo-200">Clique para salvar como PDF ou imprimir.</p>
                                    </div>
                                    <button onClick={() => window.print()} className="bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-4 rounded-xl font-black shadow-lg flex gap-2">
                                        <Download /> IMPRIMIR PDF
                                    </button>
                                </div>

                                <div className="bg-white p-10 shadow-xl min-h-[800px] border">
                                    <div className="border-b-4 border-indigo-900 pb-4 mb-8">
                                        <h1 className="text-2xl font-black uppercase text-indigo-950">Relatório de Provas Contemporâneas</h1>
                                        <p className="text-slate-500">Validação de Autonomia Técnica e Prestação de Serviços</p>
                                    </div>
                                    
                                    {clients.map(client => {
                                        const cLogs = logs.filter(l => l.clientId === client.id);
                                        if(cLogs.length === 0) return null;
                                        return (
                                            <div key={client.id} className="mb-8">
                                                <div className="bg-slate-50 p-2 border-l-4 border-indigo-600 font-bold mb-4">
                                                    TOMADOR: {client.name} | DOC: {client.cnpj}
                                                </div>
                                                <table className="w-full text-xs text-left border-collapse">
                                                    <thead>
                                                        <tr className="border-b-2 text-slate-400">
                                                            <th className="py-2">DATA</th>
                                                            <th className="py-2">DESCRIÇÃO DA AUTONOMIA</th>
                                                            <th className="py-2">VALOR</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {cLogs.map(l => (
                                                            <tr key={l.id} className="border-b border-slate-100">
                                                                <td className="py-3 font-mono">{l.date}</td>
                                                                <td className="py-3">
                                                                    <p className="font-bold">{l.type}</p>
                                                                    <p className="text-slate-500">{l.description}</p>
                                                                </td>
                                                                <td className="py-3 text-right font-bold">R$ {l.amount.toFixed(2)}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        );
                                    })}

                                    <div className="mt-20 flex flex-col items-center">
                                        <div className="w-64 border-b border-black mb-2"></div>
                                        <p className="text-sm font-bold uppercase">Assinatura do Prestador</p>
                                        <p className="text-[10px] text-slate-400 mt-10 italic text-center">
                                            Documento gerado eletronicamente. A integridade dos registros pode ser conferida via Hashes locas.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
